<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ResNet 架构图</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        
        .header {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 24px;
            font-weight: bold;
        }
        
        .controls {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            background-color: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn:hover {
            background-color: rgba(255,255,255,0.3);
        }
        
        .btn.active {
            background-color: rgba(255,255,255,0.4);
        }
        
        .main {
            flex: 1;
            display: flex;
            overflow: hidden;
        }
        
        .sidebar {
            width: 250px;
            background-color: white;
            border-right: 1px solid #ddd;
            padding: 20px;
            overflow-y: auto;
        }
        
        .sidebar h3 {
            margin-bottom: 15px;
            font-size: 18px;
            color: #4CAF50;
        }
        
        .layer-info {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }
        
        .layer-info h4 {
            margin-bottom: 10px;
            font-size: 16px;
            color: #333;
        }
        
        .layer-info p {
            margin-bottom: 5px;
            font-size: 14px;
            color: #666;
        }
        
        .canvas-container {
            flex: 1;
            position: relative;
            overflow: hidden;
            background-color: white;
        }
        
        #resnet-svg {
            position: absolute;
            top: 0;
            left: 0;
            cursor: move;
        }
        
        /* SVG样式 */
        .node {
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .node:hover {
            opacity: 0.8;
        }
        
        .node.selected {
            stroke: #4CAF50;
            stroke-width: 3;
        }
        
        .conv-layer {
            fill: #4FC3F7;
        }
        
        .bn-layer {
            fill: #81C784;
        }
        
        .relu-layer {
            fill: #FFB74D;
        }
        
        .pool-layer {
            fill: #BA68C8;
        }
        
        .residual-block {
            fill: #FF8A65;
        }
        
        .avgpool-layer {
            fill: #90A4AE;
        }
        
        .fc-layer {
            fill: #7986CB;
        }
        
        .shortcut {
            stroke: #E53935;
            stroke-width: 2;
            stroke-dasharray: 5,5;
        }
        
        .connection {
            stroke: #666;
            stroke-width: 2;
        }
        
        .text {
            font-size: 12px;
            fill: #333;
            text-anchor: middle;
            dominant-baseline: middle;
            pointer-events: none;
        }
        
        .dimension {
            font-size: 10px;
            fill: #666;
            text-anchor: middle;
            dominant-baseline: middle;
            pointer-events: none;
        }
        
        .stage-label {
            font-size: 14px;
            font-weight: bold;
            fill: #4CAF50;
            text-anchor: middle;
            dominant-baseline: middle;
            pointer-events: none;
        }
        
        /* 编辑模式 */
        .edit-mode .node {
            cursor: text;
        }
        
        .edit-input {
            position: absolute;
            font-size: 12px;
            padding: 2px 4px;
            border: 1px solid #4CAF50;
            border-radius: 4px;
            background-color: white;
            outline: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ResNet 架构图</h1>
            <div class="controls">
                <button class="btn" onclick="toggleEditMode()">编辑模式</button>
                <button class="btn" onclick="toggleDimensions()">显示维度</button>
                <button class="btn" onclick="zoomIn()">放大</button>
                <button class="btn" onclick="zoomOut()">缩小</button>
                <button class="btn" onclick="resetView()">重置视图</button>
                <button class="btn" onclick="exportAsImage()">导出图片</button>
            </div>
        </div>
        <div class="main">
            <div class="sidebar">
                <h3>ResNet 架构信息</h3>
                <div class="layer-info">
                    <h4>输入层</h4>
                    <p>维度: 3 × 224 × 224</p>
                    <p>描述: RGB彩色图像</p>
                </div>
                <div class="layer-info">
                    <h4>初始卷积</h4>
                    <p>类型: 7×7 卷积</p>
                    <p>输出维度: 64 × 112 × 112</p>
                    <p>步长: 2</p>
                    <p>填充: 3</p>
                </div>
                <div class="layer-info">
                    <h4>最大池化</h4>
                    <p>类型: 3×3 池化</p>
                    <p>输出维度: 64 × 56 × 56</p>
                    <p>步长: 2</p>
                    <p>填充: 1</p>
                </div>
                <div class="layer-info">
                    <h4>Stage 1</h4>
                    <p>残差块: 4个 BasicBlock</p>
                    <p>输出维度: 64 × 56 × 56</p>
                </div>
                <div class="layer-info">
                    <h4>Stage 2</h4>
                    <p>残差块: 4个 BasicBlock</p>
                    <p>输出维度: 128 × 28 × 28</p>
                </div>
                <div class="layer-info">
                    <h4>Stage 3</h4>
                    <p>残差块: 8个 BasicBlock</p>
                    <p>输出维度: 256 × 14 × 14</p>
                </div>
                <div class="layer-info">
                    <h4>Stage 4</h4>
                    <p>残差块: 4个 BasicBlock</p>
                    <p>输出维度: 512 × 7 × 7</p>
                </div>
                <div class="layer-info">
                    <h4>自适应平均池化</h4>
                    <p>输出维度: 512 × 1 × 1</p>
                </div>
                <div class="layer-info">
                    <h4>全连接层</h4>
                    <p>输出维度: 1000</p>
                    <p>描述: 分类输出</p>
                </div>
            </div>
            <div class="canvas-container">
                <svg id="resnet-svg" width="2000" height="1500" viewBox="0 0 2000 1500">
                    <!-- 背景网格 -->
                    <defs>
                        <pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse">
                            <path d="M 20 0 L 0 0 0 20" fill="none" stroke="#eee" stroke-width="0.5"/>
                        </pattern>
                    </defs>
                    <rect width="2000" height="1500" fill="url(#grid)"/>
                    
                    <!-- 输入层 -->
                    <rect x="100" y="500" width="120" height="60" rx="5" class="node conv-layer" data-type="input" data-dim="3×224×224"/>
                    <text x="160" y="530" class="text">输入层</text>
                    <text x="160" y="550" class="dimension">3×224×224</text>
                    
                    <!-- 初始卷积层 -->
                    <rect x="300" y="450" width="120" height="60" rx="5" class="node conv-layer" data-type="conv" data-dim="64×112×112"/>
                    <text x="360" y="480" class="text">卷积层</text>
                    <text x="360" y="500" class="text">7×7, 64</text>
                    <text x="360" y="520" class="dimension">64×112×112</text>
                    <line x1="220" y1="530" x2="300" y2="480" class="connection"/>
                    
                    <!-- 批归一化 -->
                    <rect x="300" y="530" width="120" height="60" rx="5" class="node bn-layer" data-type="bn" data-dim="64×112×112"/>
                    <text x="360" y="560" class="text">BN</text>
                    <text x="360" y="580" class="dimension">64×112×112</text>
                    <line x1="360" y1="510" x2="360" y2="530" class="connection"/>
                    
                    <!-- ReLU -->
                    <rect x="300" y="610" width="120" height="60" rx="5" class="node relu-layer" data-type="relu" data-dim="64×112×112"/>
                    <text x="360" y="640" class="text">ReLU</text>
                    <text x="360" y="660" class="dimension">64×112×112</text>
                    <line x1="360" y1="590" x2="360" y2="610" class="connection"/>
                    
                    <!-- 最大池化 -->
                    <rect x="500" y="530" width="120" height="60" rx="5" class="node pool-layer" data-type="pool" data-dim="64×56×56"/>
                    <text x="560" y="560" class="text">最大池化</text>
                    <text x="560" y="580" class="text">3×3</text>
                    <text x="560" y="600" class="dimension">64×56×56</text>
                    <line x1="420" y1="640" x2="500" y2="560" class="connection"/>
                    
                    <!-- Stage 1 -->
                    <text x="750" y="400" class="stage-label">Stage 1</text>
                    
                    <!-- Stage 1 - 残差块1 -->
                    <rect x="700" y="450" width="150" height="200" rx="10" class="node residual-block" data-type="residual" data-dim="64×56×56"/>
                    <text x="775" y="550" class="text">残差块1</text>
                    <text x="775" y="575" class="text">BasicBlock</text>
                    <text x="775" y="600" class="dimension">64×56×56</text>
                    <line x1="620" y1="560" x2="700" y2="550" class="connection"/>
                    
                    <!-- Stage 1 - 残差块2 -->
                    <rect x="900" y="450" width="150" height="200" rx="10" class="node residual-block" data-type="residual" data-dim="64×56×56"/>
                    <text x="975" y="550" class="text">残差块2</text>
                    <text x="975" y="575" class="text">BasicBlock</text>
                    <text x="975" y="600" class="dimension">64×56×56</text>
                    <line x1="850" y1="550" x2="900" y2="550" class="connection"/>
                    
                    <!-- Stage 1 - 残差块3 -->
                    <rect x="1100" y="450" width="150" height="200" rx="10" class="node residual-block" data-type="residual" data-dim="64×56×56"/>
                    <text x="1175" y="550" class="text">残差块3</text>
                    <text x="1175" y="575" class="text">BasicBlock</text>
                    <text x="1175" y="600" class="dimension">64×56×56</text>
                    <line x1="1050" y1="550" x2="1100" y2="550" class="connection"/>
                    
                    <!-- Stage 1 - 残差块4 -->
                    <rect x="1300" y="450" width="150" height="200" rx="10" class="node residual-block" data-type="residual" data-dim="64×56×56"/>
                    <text x="1375" y="550" class="text">残差块4</text>
                    <text x="1375" y="575" class="text">BasicBlock</text>
                    <text x="1375" y="600" class="dimension">64×56×56</text>
                    <line x1="1250" y1="550" x2="1300" y2="550" class="connection"/>
                    
                    <!-- Stage 2 -->
                    <text x="750" y="750" class="stage-label">Stage 2</text>
                    
                    <!-- Stage 2 - 残差块1 (带projection shortcut) -->
                    <rect x="700" y="800" width="150" height="200" rx="10" class="node residual-block" data-type="residual" data-dim="128×28×28"/>
                    <text x="775" y="900" class="text">残差块1</text>
                    <text x="775" y="925" class="text">BasicBlock</text>
                    <text x="775" y="950" class="dimension">128×28×28</text>
                    <line x1="1450" y1="550" x2="775" y2="800" class="connection"/>
                    <line x1="775" y1="650" x2="775" y2="800" class="shortcut"/>
                    <text x="750" y="725" class="text" style="fill: #E53935;">Projection Shortcut</text>
                    
                    <!-- Stage 2 - 残差块2 -->
                    <rect x="900" y="800" width="150" height="200" rx="10" class="node residual-block" data-type="residual" data-dim="128×28×28"/>
                    <text x="975" y="900" class="text">残差块2</text>
                    <text x="975" y="925" class="text">BasicBlock</text>
                    <text x="975" y="950" class="dimension">128×28×28</text>
                    <line x1="850" y1="900" x2="900" y2="900" class="connection"/>
                    
                    <!-- Stage 2 - 残差块3 -->
                    <rect x="1100" y="800" width="150" height="200" rx="10" class="node residual-block" data-type="residual" data-dim="128×28×28"/>
                    <text x="1175" y="900" class="text">残差块3</text>
                    <text x="1175" y="925" class="text">BasicBlock</text>
                    <text x="1175" y="950" class="dimension">128×28×28</text>
                    <line x1="1050" y1="900" x2="1100" y2="900" class="connection"/>
                    
                    <!-- Stage 2 - 残差块4 -->
                    <rect x="1300" y="800" width="150" height="200" rx="10" class="node residual-block" data-type="residual" data-dim="128×28×28"/>
                    <text x="1375" y="900" class="text">残差块4</text>
                    <text x="1375" y="925" class="text">BasicBlock</text>
                    <text x="1375" y="950" class="dimension">128×28×28</text>
                    <line x1="1250" y1="900" x2="1300" y2="900" class="connection"/>
                    
                    <!-- Stage 3 -->
                    <text x="750" y="1100" class="stage-label">Stage 3</text>
                    
                    <!-- Stage 3 - 残差块1 (带projection shortcut) -->
                    <rect x="700" y="1150" width="150" height="200" rx="10" class="node residual-block" data-type="residual" data-dim="256×14×14"/>
                    <text x="775" y="1250" class="text">残差块1</text>
                    <text x="775" y="1275" class="text">BasicBlock</text>
                    <text x="775" y="1300" class="dimension">256×14×14</text>
                    <line x1="1450" y1="900" x2="775" y2="1150" class="connection"/>
                    <line x1="775" y1="1000" x2="775" y2="1150" class="shortcut"/>
                    <text x="750" y="1075" class="text" style="fill: #E53935;">Projection Shortcut</text>
                    
                    <!-- 自适应平均池化 -->
                    <rect x="1550" y="500" width="120" height="60" rx="5" class="node avgpool-layer" data-type="avgpool" data-dim="512×1×1"/>
                    <text x="1610" y="530" class="text">AvgPool</text>
                    <text x="1610" y="550" class="dimension">512×1×1</text>
                    <line x1="1450" y1="1250" x2="1550" y2="530" class="connection"/>
                    
                    <!-- 全连接层 -->
                    <rect x="1750" y="500" width="120" height="60" rx="5" class="node fc-layer" data-type="fc" data-dim="1000"/>
                    <text x="1810" y="530" class="text">全连接层</text>
                    <text x="1810" y="550" class="dimension">1000</text>
                    <line x1="1670" y1="530" x2="1750" y2="530" class="connection"/>
                    
                    <!-- 输出 -->
                    <rect x="1950" y="500" width="120" height="60" rx="5" class="node conv-layer" data-type="output" data-dim="1000"/>
                    <text x="2010" y="530" class="text">输出</text>
                    <text x="2010" y="550" class="dimension">1000</text>
                    <line x1="1870" y1="530" x2="1950" y2="530" class="connection"/>
                </svg>
            </div>
        </div>
    </div>

    <script>
        // 全局变量
        let isEditMode = false;
        let showDimensions = true;
        let selectedNode = null;
        let svg = document.getElementById('resnet-svg');
        let svgRect = svg.getBoundingClientRect();
        let isDragging = false;
        let startX, startY;
        let currentScale = 1;
        let currentTranslateX = 0;
        let currentTranslateY = 0;
        
        // 初始化事件监听
        document.addEventListener('DOMContentLoaded', function() {
            initEventListeners();
        });
        
        function initEventListeners() {
            // 节点点击事件
            svg.querySelectorAll('.node').forEach(node => {
                node.addEventListener('click', handleNodeClick);
            });
            
            // SVG拖拽事件
            svg.addEventListener('mousedown', handleSvgMouseDown);
            document.addEventListener('mousemove', handleSvgMouseMove);
            document.addEventListener('mouseup', handleSvgMouseUp);
            
            // 缩放事件
            svg.addEventListener('wheel', handleWheel);
        }
        
        // 节点点击处理
        function handleNodeClick(e) {
            if (isEditMode) {
                // 编辑模式：创建输入框
                createEditInput(e.target);
            } else {
                // 选择模式：选择节点
                selectNode(e.target);
            }
        }
        
        // 选择节点
        function selectNode(node) {
            // 取消之前的选择
            if (selectedNode) {
                selectedNode.classList.remove('selected');
            }
            // 选择当前节点
            selectedNode = node;
            selectedNode.classList.add('selected');
        }
        
        // 创建编辑输入框
        function createEditInput(node) {
            const rect = node.getBoundingClientRect();
            const textElement = node.nextElementSibling;
            const text = textElement.textContent;
            
            // 创建输入框
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'edit-input';
            input.value = text;
            input.style.left = `${rect.left}px`;
            input.style.top = `${rect.top}px`;
            input.style.width = `${rect.width}px`;
            input.style.height = `${rect.height / 2}px`;
            
            // 添加到文档
            document.body.appendChild(input);
            input.focus();
            
            // 输入框事件
            input.addEventListener('blur', () => {
                // 更新文本
                textElement.textContent = input.value;
                document.body.removeChild(input);
            });
            
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    textElement.textContent = input.value;
                    document.body.removeChild(input);
                }
            });
        }
        
        // SVG拖拽处理
        function handleSvgMouseDown(e) {
            if (e.target === svg || e.target.tagName === 'rect' && e.target.getAttribute('fill') === 'url(#grid)') {
                isDragging = true;
                startX = e.clientX - currentTranslateX;
                startY = e.clientY - currentTranslateY;
                svg.style.cursor = 'grabbing';
            }
        }
        
        function handleSvgMouseMove(e) {
            if (isDragging) {
                currentTranslateX = e.clientX - startX;
                currentTranslateY = e.clientY - startY;
                updateSvgTransform();
            }
        }
        
        function handleSvgMouseUp() {
            isDragging = false;
            svg.style.cursor = 'move';
        }
        
        // 缩放处理
        function handleWheel(e) {
            e.preventDefault();
            const delta = e.deltaY > 0 ? 0.9 : 1.1;
            currentScale *= delta;
            // 限制缩放范围
            currentScale = Math.max(0.1, Math.min(5, currentScale));
            updateSvgTransform();
        }
        
        // 更新SVG变换
        function updateSvgTransform() {
            svg.style.transform = `translate(${currentTranslateX}px, ${currentTranslateY}px) scale(${currentScale})`;
        }
        
        // 控制按钮函数
        function toggleEditMode() {
            isEditMode = !isEditMode;
            const btn = event.target;
            btn.classList.toggle('active');
            btn.textContent = isEditMode ? '选择模式' : '编辑模式';
        }
        
        function toggleDimensions() {
            showDimensions = !showDimensions;
            const btn = event.target;
            btn.classList.toggle('active');
            
            const dimensions = svg.querySelectorAll('.dimension');
            dimensions.forEach(dim => {
                dim.style.display = showDimensions ? 'block' : 'none';
            });
        }
        
        function zoomIn() {
            currentScale *= 1.1;
            updateSvgTransform();
        }
        
        function zoomOut() {
            currentScale *= 0.9;
            updateSvgTransform();
        }
        
        function resetView() {
            currentScale = 1;
            currentTranslateX = 0;
            currentTranslateY = 0;
            updateSvgTransform();
        }
        
        // 导出为图片
        function exportAsImage() {
            // 创建一个新的SVG，不包含网格
            const exportSvg = svg.cloneNode(true);
            exportSvg.querySelector('rect[fill="url(#grid)"]').remove();
            
            // 转换为Data URL
           